<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/payment.css">
    <title>주문/결제 페이지</title>
</head>
<body>
<header th:include="header"></header>
<section class="content">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb float-end">
            <li class="breadcrumb-item small"><a href="#" class="text-black">Home</a></li>
            <li class="breadcrumb-item active small" aria-current="page">주문/결제</li>
        </ol>
    </nav>
    <h3 class="pt-5 mt-2 mb-3 text-center">주문/결제</h3>
    <h5 class="order-title">주문자 정보</h5>
    <form action="" name="payment">
        <div class="d-flex justify-content-between">
            <div class="left-content" id="left-content"><!--왼쪽 전체 영역-->
                <table class="table align-middle mb-5"><!--첫번째 주문자 정보 테이블-->
                    <tr>
                        <th>이름</th>
                        <td><input type="text" name="order_userName"  required></td>
                    </tr>
                    <tr class="border-white">
                        <th rowspan="2" class="border-bottom">이메일</th>
                        <td class="email">
                            <input type="text" name="order_userId" value="gonigoni1216" class="email" required> @
                            <input type="text" name="order-userEmail" class="email" id="input-userEmail" required>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <select class="form-select" name="order-userEmail" id="select-userEmail">
                                <option value="직접 입력" selected>직접 입력</option> <!--직접입력 누르면 위에 입력하는 칸에 입력할 수 있게-->
                                <option value="naver.com">naver.com</option>
                                <option value="gmail.com">gmail.com</option>
                                <option value="nate.com">nate.com</option>
                                <option value="daum.net">daum.net</option>
                                <option value="icolud.com">icloud.com</option>
                            </select>
                        </td>
                    </tr>
                    <tr class="tr-last">
                        <th>연락처</th>
                        <td><input type="text"  id="p_num1" value="010" class="order-num" required> -
                            <input type="text"   id="p_num2" class="order-num" required> -
                            <input type="text"  id="p_num3" class="order-num" required></td>
                        <input type="hidden" id="order_userTel" name="order_userTel1">
                    </tr>
                </table><!--주문자 정보 테이블 끝-->

                <div class="d-flex justify-content-between align-items-center"><!--배송 정보 테이블 타이틀-->
                    <span class="order-title fs-5">배송 정보</span>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="myCheckbox" name="myCheckbox" value="isChecked">
                        <label class="form-check-label" for="myCheckbox">위 정보와 동일</label>
                    </div>
                </div>
                <table class="table align-middle"><!--배송 정보 테이블-->
                    <tr>
                        <th>이름</th>
                        <td><input type="text" name="order_userName" value="유고운" required></td>
                    </tr>
                    <tr>
                        <th>연락처1</th>
                        <td><input type="text" id="p_num4" value="010" class="order-num" required> -
                            <input type="text"  id="p_num5" value="" class="order-num" required> -
                            <input type="text"  id="p_num6" value="" class="order-num" required></td>
                        <input type="hidden" id="order_deliveryTel1" name="order_deliveryTel1">
                    </tr>
                    <tr>
                        <th>연락처2</th>
                        <td><input type="text"  id="p_num7"  value="010" class="order-num"> -
                            <input type="text"  id="p_num8" value="" class="order-num"> -
                            <input type="text" id="p_num9" value="" class="order-num"></td>
                        <input type="hidden" id="order_deliveryTel2" name="order_deliveryTel2">
                    </tr>
<!--                    <tr>-->
<!--                        <th>배송지 선택</th>-->
<!--                        <td>-->
<!--                            <div class="form-check form-check-inline py-2 px-3">-->
<!--                                <input class="form-check-input" type="radio" name="delivery_address1" id="delivery_address1" value="option1">-->
<!--                                <label class="form-check-label" for="delivery_address1">집</label>-->
<!--                            </div>-->
<!--                            <div class="form-check form-check-inline px-3">-->
<!--                                <input class="form-check-input" type="radio" name="delivery_address2" id="delivery_address2" value="option2">-->
<!--                                <label class="form-check-label" for="delivery_address2">직장</label>-->
<!--                            </div>-->
<!--                            <div class="form-check form-check-inline px-3">-->
<!--                                <input class="form-check-input" type="radio" name="delivery_address3" id="delivery_address3" value="option3">-->
<!--                                <label class="form-check-label" for="delivery_address3">콩떡집</label>-->
<!--                            </div>-->
<!--                            <button class="btn btn-outline-secondary">주소록</button>-->
<!--                        </td>-->
<!--                    </tr>-->
                    <tr class="border-white">
                        <th rowspan="3" class="border-bottom">주소</th>
                        <td class="delivery">
                            <input type="text" name="order_zipcode" value="08616" class="w-25" required>
                            <button class="btn btn-outline-secondary align-middle zipcode">우편번호</button>
                        </td>
                    </tr>
                    <tr class="border-white">
                        <td>
                            <input type="text" name="order_addr" value="독산동" class="address" required>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" name="order_addrdetail" value="독산2동" class="address" required>
                        </td>
                    </tr>
                    <tr>
                        <th>배송메세지</th>
                        <td><textarea name="order_req" rows="5"></textarea></td>
                    </tr>
                </table>
                <div class="form-check mb-5">
                    <input class="form-check-input" type="checkbox" id="myDelivery" name="myDelivery" value="ischekced">
                    <label class="form-check-label" for="myCheckbox">해당 배송지 정보를 나의 정보로 등록합니다.</label>
                </div>
                <div class="order-product">
                <h5 class="order-title">주문 상품</h5>
                <table class="table align-middle text-center mb-5">
                    <tr>
                        <td colspan="2" class="py-3">상품명</td>
                        <td>할인</td>
                        <td>쿠폰할인</td>
                        <td>적립</td>
                        <td>주문금액</td>
                    </tr>
                    <tr>
                        <td class="text-end"><img src="img//img1.png" class="img"></td>
                        <td class="text-start">상품명 - 귀여운 강아지 인형</td>
                        <td class="text-danger">-450000원</td>
                        <td></td>
                        <td>0</td>
                        <td><del><small class="text-secondary">48,000원</small></del><br><strong>24,000원</strong></td>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <p class="fs-5 pt-3 ">
                                주문금액 <strong>48,000원</strong><strong class="text-danger"> -상품할인 24,000원</strong>
                                +배송비<strong>0원</strong> =<strong> 주문금액 24,000원</strong></p>
                        </td>
                    </tr>
                </table>
                </div>
                <h5 class="order-title">할인 정보</h5>
                <table class="table align-middle mb-5">
                    <tr>
                        <td class="point">적립금 사용</td>
                        <td class="d-flex justify-content-center border-white w-100"><input type="text" name="user_point" value="0">
                            <div class="form-check pt-3 mx-1">
                                <input class="form-check-input" type="checkbox" id="user_point" name="user_point" value="pointAll">
                                <label class="form-check-label" for="myCheckbox">전액 사용</label>
                            </div>
                        </td>
                        <td class="w-25">
                            (사용가능:<input type="text" value="640" class="w-50">원)
                        </td>
                    </tr>
                </table>

                <h5 class="order-title">결제 수단 선택</h5>
                <table class="table align-middle border">
                    <tr>
                        <th rowspan="4" >결제수단</th>
                        <td class="payment">
                            <div class="form-check mx-1 pt-1 mt-1">
                                <input class="form-check-input" type="checkbox" id="order_paymethod1" name="order_paymethod" value="card">
                                <label class="form-check-label" for="order_paymethod1">카드 결제</label>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-white">
                        <td>
                            <div class="form-check  mx-1  pt-1">
                                <input class="form-check-input" type="checkbox" id="order_paymethod2" name="order_paymethod" value="kakaopay">
                                <label class="form-check-label" for="order_paymethod2">카카오페이</label>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-white">
                        <td>
                            <div class="form-check  mx-1 pt-1">
                                <input class="form-check-input" type="checkbox" id="order_paymethod3" name="order_paymethod" value=".">
                                <label class="form-check-label" for="order_paymethod3">가상 계좌</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-check  mx-1 pt-1 mb-1">
                                <input class="form-check-input" type="checkbox" id="order_paymethod4" name="order_paymethod" value="toss">
                                <label class="form-check-label" for="order_paymethod4">토스</label>
                            </div>
                        </td>
                    </tr>
                </table>

            </div>

            <div class="border-0 right-content" id="right-content"><!--오른쪽 결제 화면-->
                <div class="border"><!--결제금액 박스-->
                    <div class="order-items"><p class="fw-bold fs-4 m-0">주문 예정 금액</p></div><!--제목-->
                    <div class="border-top order-items"><!--상품금액,배송비,할인금액,추가금액-->
                        <div class="order-item"><span class="order-title2">총 상품금액</span><strong class="order-price">42000</strong></div>
                        <div class="order-item"><span class="order-title2">배송비</span><strong class="order-price">0</strong></div>
                        <div class="order-item"><span class="order-title2">할인금액</span><strong class="order-price text-danger">13000</strong></div>
                        <div class="order-item"><span class="order-title2">추가금액</span><strong class="order-price">0</strong></div>
                    </div>
                    <div class="border-top order-items "><!--최종 결제 금액-->
                        <div class="order-item fs-5 fw-bold mb-2"><span class="order-title2">최종 결제 금액</span><strong class="order-price text-danger">27300원</strong></div>
                        <p>(적립예정:819원)<br><!--적립예정금액은 최종결제금액 0.5%?-->
                            (적립 예정금액과 최종 적립금액은 상이할 수 있습니다. 주문 완료 시 지급되는 적립금을 확인해주시기 바랍니다.)</p>
                    </div>
                </div>
                <hr class="mt-5 mb-5">
                <div>
                    <h5 class="order-title">주문동의</h5>
                    <div class="form-check my-1 order-agree">
                        <input class="form-check-input" type="checkbox" id="order_agree1" name="order_agree" value="agree" required>
                        <label class="form-check-label px-1" for="order_agree1">위 상품의 판매조건을 명확히 확인하였으며, 구매 진행에 동의합니다.
                            <br> (전자상거래법 제8조 2항)</label>
                    </div>
                    <div class="form-check my-1  order-agree">
                        <input class="form-check-input" type="checkbox" id="order_agree2" name="order_agree" value="agree" required>
                        <label class="form-check-label px-1" for="order_agree2">반품 시 결제금액에서 배송비를 차감한 금액이 환불되는 것에 동의합니다.
                        </label>
                    </div>
                    <button class="btn btn-outline-warning w-100 py-3 mt-4 fs-5" >결제하기</button>
                    <a href="/paymentCompleted">결제성공</a><a href="/paymentFailed">결제실패</a>
                </div>
            </div>
        </div>
    </form>
</section>
<footer th:include="footer"></footer>
</body>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var rightContent = document.querySelector(".right-content");
            var orderProduct = document.querySelector(".order-product");``

            // order-product 요소를 만났을 때 오른쪽 박스의 바닥이 보이게 함
            orderProduct.addEventListener("mouseenter", function() {
                // 오른쪽 박스의 scrollTop을 최대값으로 설정하여 바닥이 보이게 함
                rightContent.scrollTop = rightContent.scrollHeight;
            });

            var select = document.getElementById("select-userEmail");
            var input = document.getElementById("input-userEmail");

            select.addEventListener("change", function () {
                var selectValue = select.value;

                if (selectValue === '직접 입력') {
                    input.removeAttribute('readonly');
                    input.focus(); // 포커스를 input 요소로 이동
                    input.value = ''; // 내용을 빈 문자열로 설정하여 내용을 지움
                } else {
                    input.setAttribute('readonly', 'readonly');
                    input.value = selectValue;
                }
            })


            //전화번호 체크
            var p_num1 = document.getElementById("p_num1");
            var p_num2 = document.getElementById("p_num2");
            var p_num3 = document.getElementById("p_num3");
            var p_num4 = document.getElementById("p_num4");
            var p_num5 = document.getElementById("p_num5");
            var p_num6 = document.getElementById("p_num6");
            var p_num7 = document.getElementById("p_num7");
            var p_num8 = document.getElementById("p_num8");
            var p_num9 = document.getElementById("p_num9");

            function validatePhoneNumber(input, minLength, maxLength) {
                var value = input.value.trim();

                console.log(value);
                if (isNaN(value)) { // 숫자가 아닌 경우
                    input.focus();
                    input.value = '';
                    alert("숫자만 입력 가능합니다!");
                    return false;
                } else if (value.length < minLength || value.length > maxLength) {
                    input.focus();
                    alert("번호를 올바르게 입력하세요!");
                    return false;
                }
                return true;
            }

            p_num1.addEventListener("change", function () {
                validatePhoneNumber(p_num1, 2, 4);
            });

            p_num2.addEventListener("change", function () {
                validatePhoneNumber(p_num2, 4, 4);
            });

            p_num3.addEventListener("change", function () {
                validatePhoneNumber(p_num3, 4, 4);
            });
            p_num4.addEventListener("change", function () {
                validatePhoneNumber(p_num4, 2, 4);
            });

            p_num5.addEventListener("change", function () {
                validatePhoneNumber(p_num5, 4, 4);
            });

            p_num6.addEventListener("change", function () {
                validatePhoneNumber(p_num6, 4, 4);
            });
            p_num7.addEventListener("change", function () {
                validatePhoneNumber(p_num7, 2, 4);
            });

            p_num8.addEventListener("change", function () {
                validatePhoneNumber(p_num8, 4, 4);
            });

            p_num9.addEventListener("change", function () {
                validatePhoneNumber(p_num9, 4, 4);
            });

        });

        // 폼 요소 가져오기
        var form = document.querySelector("form[name='payment']");

        // 폼 제출 시 실행할 함수
        function handleSubmit(event) {
            // 입력 요소의 값 가져오기
            var p_num1 = document.getElementById("p_num1").value;
            var p_num2 = document.getElementById("p_num2").value;
            var p_num3 = document.getElementById("p_num3").value;
            var p_num4 = document.getElementById("p_num4").value;
            var p_num5 = document.getElementById("p_num5").value;
            var p_num6 = document.getElementById("p_num6").value;
            var p_num7 = document.getElementById("p_num7").value;
            var p_num8 = document.getElementById("p_num8").value;
            var p_num9 = document.getElementById("p_num9").value;

            // 전화번호 값 합치기
            var telNumber1 = p_num1 + p_num2 + p_num3;
            var telNumber2= p_num4 + p_num5 + p_num6;
            var telNumber3= p_num7 + p_num8 + p_num9;

            // 숨겨진 입력 요소에 값 설정
            document.getElementById("order_userTel").value = telNumber1;
            document.getElementById("order_deliveryTel1").value=telNumber2;
            if( p_num7 && p_num8 && p_num9) {
                document.getElementById("order_deliveryTel2").value=telNumber3;
            }
            console.log("주문자 연락처 :"+telNumber1);
            console.log("배송지 연락처 :"+telNumber2);
            console.log("배송지 연락처 :"+telNumber3);
        }

        // 폼 제출 이벤트에 핸들러 등록
        form.addEventListener("submit", handleSubmit);


    </script>
</html>